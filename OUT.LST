Turbo Assembler	 Version 4.1	    21/11/22 05:43:03	    Page 1
lab1_3.asm



      1	    0000			 .model	small
      2					 LOCALS
      3					 .486
      4	    0000			 .stack	100h
      5					 org 100h
      6
      7	    0000			 .data
      8	    0000  00000000				 A		 dd 0.0
      9	    0004  40C90E56				 B		 dd 6.2830
     10	    0008  00000000				 H		 dd 0
     11	    000C  00000000				 Curr	 dd 0
     12	    0010  0280*(00000000)			 Y		 dd 640	dup(0)
     13	    0A10  00000000				 Min		 dd 0
     14	    0A14  00000000				 Max		 dd 0
     15	    0A18  00000000				 K		 dd 0
     16	    0A1C  0280*(0000)				 Yabs	 dw 640	dup(0)
     17	    0F1C  00F0					 icwr	 dw 00F0h
     18	    0F1E  0000					 icwr_	 dw 0
     19	    0F20  0280					 Wid		 dw 640
     20	    0F22  01DF					 Hei		 dw 479
     21	    0F24  0D 0A	24				 crlf	 db 13,10,"$"
     22	    0F27  57 72	69 74 65 20 66+			 t1		 db "Write float ",13,10,"$"
     23		  6C 6F	61 74 20 0D 0A+
     24		  24
     25	    0F36			 .code
     26	    0000			 replace proc near
     27	    0000  55				 push bp
     28	    0001  8B EC				 mov bp, sp
     29	    0003  53				 push bx
     30	    0004  56				 push SI
     31
     32	    0005  8B 76	08			 mov	 si, [bp + 8] ;	str
     33	    0008  8A 7E	06			 mov bh, [bp + 6] ; from
     34	    000B  8A 5E	04			 mov bl, [bp + 4] ; to
     35
     36	    000E				 replace_while:
     37	    000E  80 3C	24			 cmp byte ptr [si], "$"
     38	    0011  74 09				 je	 replace_while_end
     39
     40	    0013  38 3C				 cmp byte ptr ds:[si], bh
     41	    0015  75 02				 jne replace_while_skip
     42	    0017  88 1C				 mov [si], bl
     43	    0019				 replace_while_skip:
     44	    0019  46				 inc si
     45	    001A  EB F2				 jmp replace_while
     46	    001C				 replace_while_end:
     47
     48
     49	    001C  5E				 pop SI
     50	    001D  5B				 pop bx
     51	    001E  5D				 pop bp
     52	    001F  C3				 ret
     53	    0020			 replace endp
     54
     55					 ; in: st(0)
     56					 ; out:	st(0)
     57	    0020			 fn_calc proc near
Turbo Assembler	 Version 4.1	    21/11/22 05:43:03	    Page 2
lab1_3.asm



     58	    0020  55				 push bp
     59	    0021  8B EC				 mov bp, sp
     60
     61	    0023  D9 FB				 fsincos
     62	    0025  D8 C8				 fmul st(0), st(0)
     63	    0027  D9 C9				 fxch st(1)
     64	    0029  D9 C0				 fld st(0)
     65	    002B  D8 C9				 fmul st(0), st(1)
     66	    002D  DE C9				 fmulp
     67	    002F  DE C1				 faddp
     68
     69	    0031  5D				 pop bp
     70	    0032  C3				 ret
     71	    0033			 fn_calc endp
     72
     73	    0033			 fn proc near
     74	    0033  55				 push bp
     75	    0034  8B EC				 mov bp, sp
     76	    0036  50				 push ax
     77	    0037  51				 push cx
     78	    0038  53				 push bx
     79
     80						 ; Calculate Y Walues for range	[A-B] with step	H
     81	    0039  8B 0E	0F20r			 mov cx, [Wid]
     82	    003D  D9 06	0004r			 fld B
     83	    0041  D9 1E	000Cr			 fstp Curr
     84
     85	    0045				 fn_loop1:
     86
     87	    0045  83 E9	01			 sub cx, 1
     88	    0048  8B D9				 mov bx, cx
     89
     90	    004A  C1 E3	02			 shl bx, 2
     91
     92	    004D  D9 06	000Cr			 fld Curr
     93
     94	    0051  E8 FFCC			 call fn_calc
     95
     96	    0054  D9 9F	0010r			 fstp Y[bx]
     97
     98	    0058  D9 06	000Cr			 fld Curr
     99	    005C  D9 06	0008r			 fld H
    100	    0060  DE E9				 fsubp
    101	    0062  D9 1E	000Cr			 fstp Curr
    102
    103	    0066  83 C1	01			 add cx, 1
    104	    0069  E2 DA				 loop fn_loop1
    105
    106	    006B  D9 06	0010r			 fld Y[0]
    107	    006F  D9 16	0A14r			 fst Max
    108	    0073  D9 1E	0A10r			 fstp Min
    109
    110						 ; Min & Max Calc
    111	    0077  8B 0E	0F20r			 mov cx, [Wid]
    112	    007B				 fn_loop2:
    113	    007B  83 E9	01			 sub cx, 1
    114	    007E  8B D9				 mov bx, cx
Turbo Assembler	 Version 4.1	    21/11/22 05:43:03	    Page 3
lab1_3.asm



    115	    0080  C1 E3	02			 shl bx, 2
    116
    117	    0083  D9 87	0010r			 fld Y[bx]
    118	    0087  D9 06	0A14r			 fld Max
    119	    008B  D9 C9				 fxch
    120
    121						 ; cmp max & fpu top
    122	    008D  D8 D1				 fcom st(1)
    123	    008F  9B DF	E0			 fstsw ax
    124	    0092  9E				 sahf
    125	    0093  72 06				 jc fn_loop2_endMax
    126	    0095  74 04				 jz fn_loop2_endMax
    127	    0097  D9 16	0A14r			 fst Max
    128	    009B				 fn_loop2_endMax:
    129
    130	    009B  DD C1				 ffree
    131	    009D  D9 06	0A10r			 fld Min
    132	    00A1  D9 C9				 fxch
    133
    134						 ; cmp min & fpu top
    135	    00A3  D8 D1				 fcom st(1)
    136	    00A5  9B DF	E0			 fstsw ax
    137	    00A8  9E				 sahf
    138	    00A9  73 04				 jnc fn_loop2_endMin
    139
    140	    00AB  D9 16	0A10r			 fst Min
    141	    00AF				 fn_loop2_endMin:
    142
    143						 ; fxch
    144	    00AF  83 C1	01			 add cx,1
    145	    00B2  DD C0				 ffree st(0)
    146	    00B4  D9 F7				 fincstp
    147	    00B6  DD C0				 ffree st(0)
    148
    149	    00B8  E2 C1				 loop fn_loop2
    150
    151	    00BA  D9 06	0A14r			 fld Max
    152	    00BE  D8 26	0A10r			 fsub Min
    153	    00C2  DF 06	0F22r			 fild Hei
    154	    00C6  D9 C9				 fxch
    155	    00C8  DE F9				 fdivp
    156	    00CA  D9 1E	0A18r			 fstp K
    157	    00CE  E8 00A9			 call setRoundNear
    158
    159	    00D1  8B 0E	0F20r			 mov cx, [Wid]
    160	    00D5				 fn_loop3:
    161
    162	    00D5  83 E9	01			 sub cx, 1
    163	    00D8  8B D9				 mov bx, cx
    164	    00DA  C1 E3	02			 shl bx, 2
    165	    00DD  D9 06	0A18r			 fld K
    166
    167	    00E1  D9 87	0010r			 fld Y[bx]
    168	    00E5  D8 26	0A10r			 fsub Min
    169	    00E9  DE C9				 fmul
    170	    00EB  DF 06	0F22r			 fild Hei
    171	    00EF  D9 C9				 fxch
Turbo Assembler	 Version 4.1	    21/11/22 05:43:03	    Page 4
lab1_3.asm



    172	    00F1  DE E9				 fsubp
    173	    00F3  D1 EB				 shr bx, 1
    174	    00F5  DF 9F	0A1Cr			 fistp Yabs[bx]
    175
    176	    00F9  83 C1	01			 add cx, 1
    177	    00FC  E2 D7				 loop fn_loop3
    178
    179	    00FE  5B				 pop bx
    180	    00FF  59				 pop cx
    181	    0100  58				 pop ax
    182	    0101  5D				 pop bp
    183	    0102  C3				 ret
    184	    0103			 fn endp
    185
    186	    0103			 gets proc near
    187	    0103  55				 push bp
    188	    0104  8B EC				 mov bp, sp
    189
    190
    191
    192	    0106  5D				 pop bp
    193	    0107  C3				 ret
    194	    0108			 gets endp
    195
    196	    0108			 stof proc near
    197	    0108  55				 push bp
    198	    0109  8B EC				 mov bp, sp
    199
    200
    201
    202	    010B  5D				 pop bp
    203	    010C  C3				 ret
    204	    010D			 stof endp
    205
    206	    010D			 puts proc near
    207	    010D  55				 push bp
    208	    010E  8B EC				 mov bp, sp
    209	    0110  50				 push ax
    210	    0111  52				 push dx
    211
    212	    0112  B8 0900			 mov ax, 0900h
    213	    0115  8B 56	04			 mov dx, [bp + 4]
    214	    0118  CD 21				 int 21h
    215
    216	    011A  5A				 pop dx
    217	    011B  58				 pop ax
    218	    011C  5D				 pop bp
    219	    011D  C3				 ret
    220	    011E			 puts endp
    221
    222	    011E			 getch proc near
    223	    011E  55				 push bp
    224	    011F  8B EC				 mov bp, sp
    225	    0121  50				 push ax
    226
    227	    0122  B8 0800			 mov ax, 0800h
    228	    0125  CD 21				 int 21h
Turbo Assembler	 Version 4.1	    21/11/22 05:43:03	    Page 5
lab1_3.asm



    229
    230	    0127  58				 pop ax
    231	    0128  5D				 pop bp
    232	    0129  C3				 ret
    233	    012A			 getch endp
    234
    235	    012A			 setvid	proc near
    236	    012A  55				 push bp
    237	    012B  8B EC				 mov bp, sp
    238	    012D  50				 push ax
    239
    240	    012E  B8 0012			 mov ax, 0012h
    241	    0131  CD 10				 int 10h
    242
    243	    0133  B8 0500			 mov ax, 0500h
    244	    0136  CD 10				 int 10h
    245
    246	    0138  58				 pop ax
    247	    0139  5D				 pop bp
    248	    013A  C3				 ret
    249	    013B			 setvid	endp
    250
    251	    013B			 settext proc near
    252	    013B  55				 push bp
    253	    013C  8B EC				 mov bp, sp
    254	    013E  50				 push ax
    255
    256	    013F  B8 0003			 mov ax, 0003h
    257	    0142  CD 10				 int 10h
    258
    259	    0144  B8 0500			 mov ax, 0500h
    260	    0147  CD 10				 int 10h
    261
    262	    0149  58				 pop ax
    263	    014A  5D				 pop bp
    264	    014B  C3				 ret
    265	    014C			 settext endp
    266
    267	    014C			 setRoundDown proc near
    268	    014C  55				 push bp
    269	    014D  8B EC				 mov bp, sp
    270	    014F  50				 push ax
    271
    272						 local @@tmp_cwr: word
    273
    274	    0150  9B D9	7E FE			 fstcw @@tmp_cwr
    275	    0154  8B 46	FE			 mov ax, [@@tmp_cwr]
    276	    0157  0D 0100			 or ax,	0100h
    277	    015A  89 46	FE			 mov [@@tmp_cwr], ax
    278	    015D  D9 6E	FE			 fldcw @@tmp_cwr
    279
    280
    281	    0160  58				 pop ax
    282	    0161  5D				 pop bp
    283	    0162  C3				 ret
    284	    0163			 setRoundDown endp
    285
Turbo Assembler	 Version 4.1	    21/11/22 05:43:03	    Page 6
lab1_3.asm



    286	    0163			 setRoundUp proc near
    287	    0163  55				 push bp
    288	    0164  8B EC				 mov bp, sp
    289	    0166  50				 push ax
    290
    291						 local @@tmp_cwr: word
    292
    293	    0167  9B D9	7E FE			 fstcw @@tmp_cwr
    294	    016B  8B 46	FE			 mov ax, [@@tmp_cwr]
    295	    016E  0D 0200			 or ax,	0200h
    296	    0171  89 46	FE			 mov [@@tmp_cwr], ax
    297	    0174  D9 6E	FE			 fldcw @@tmp_cwr
    298
    299	    0177  58				 pop ax
    300	    0178  5D				 pop bp
    301	    0179  C3				 ret
    302	    017A			 setRoundUp endp
    303
    304
    305	    017A			 setRoundNear proc near
    306	    017A  55				 push bp
    307	    017B  8B EC				 mov bp, sp
    308	    017D  50				 push ax
    309
    310						 local @@tmp_cwr: word
    311
    312	    017E  9B D9	7E FE			 fstcw @@tmp_cwr
    313	    0182  8B 46	FE			 mov ax, [@@tmp_cwr]
    314	    0185  25 FCFF			 and ax, 0FCFFh
    315	    0188  89 46	FE			 mov [@@tmp_cwr], ax
    316	    018B  D9 6E	FE			 fldcw @@tmp_cwr
    317
    318
    319	    018E  58				 pop ax
    320	    018F  5D				 pop bp
    321	    0190  C3				 ret
    322	    0191			 setRoundNear endp
    323
    324	    0191			 point proc near
    325	    0191  55				 push bp
    326	    0192  8B EC				 mov bp, sp
    327	    0194  50				 push ax
    328	    0195  53				 push bx
    329	    0196  51				 push cx
    330	    0197  52				 push dx
    331
    332	    0198  B8 0C0A			 mov ax, 0c0Ah
    333	    019B  BB 0000			 mov bx, 0000h
    334	    019E  8B 4E	06			 mov cx, [bp + 6]
    335	    01A1  8B 56	04			 mov dx, [bp + 4]
    336	    01A4  CD 10				 int 10h
    337
    338	    01A6  5A				 pop dx
    339	    01A7  59				 pop cx
    340	    01A8  5B				 pop bx
    341	    01A9  58				 pop ax
    342	    01AA  5D				 pop bp
Turbo Assembler	 Version 4.1	    21/11/22 05:43:03	    Page 7
lab1_3.asm



    343	    01AB  C3				 ret
    344	    01AC			 point endp
    345
    346	    01AC			 draw_fn proc near
    347	    01AC  55				 push bp
    348	    01AD  8B EC				 mov bp, sp
    349	    01AF  51				 push cx
    350	    01B0  53				 push bx
    351	    01B1  52				 push dx
    352
    353	    01B2  8B 0E	0F20r			 mov cx, [Wid]
    354	    01B6				 draw_fn_loop1:
    355	    01B6  49				 dec cx
    356	    01B7  8B D9				 mov bx, cx
    357	    01B9  D1 E3				 shl bx, 1
    358
    359	    01BB  8B 97	0A1Cr			 mov dx, Yabs[bx]
    360	    01BF  51				 push cx
    361	    01C0  52				 push dx
    362	    01C1  E8 FFCD			 call point
    363	    01C4  83 C4	04			 add sp, 4
    364	    01C7  41				 inc cx
    365	    01C8  E2 EC				 loop draw_fn_loop1
    366
    367	    01CA  5A				 pop dx
    368	    01CB  5B				 pop bx
    369	    01CC  59				 pop cx
    370	    01CD  5D				 pop bp
    371	    01CE  C3				 ret
    372	    01CF			 draw_fn endp
    373
    374	    01CF			 draw_scr proc near
    375	    01CF  55				 push bp
    376	    01D0  8B EC				 mov bp, sp
    377	    01D2  51				 push cx
    378
    379	    01D3  8B 0E	0F20r			 mov cx, [Wid]
    380	    01D7				 draw_scr_loop1:
    381	    01D7  49				 dec cx
    382	    01D8  51				 push cx
    383	    01D9  6A 00				 push 0
    384	    01DB  E8 FFB3			 call point
    385	    01DE  83 C4	04			 add sp, 4
    386
    387	    01E1  51				 push cx
    388	    01E2  68 01DF			 push 479
    389	    01E5  E8 FFA9			 call point
    390	    01E8  83 C4	04			 add sp, 4
    391	    01EB  41				 inc cx
    392	    01EC  E2 E9				 loop draw_scr_loop1
    393	    01EE  8B 0E	0F22r			 mov cx, [Hei]
    394	    01F2				 draw_scr_loop2:
    395	    01F2  49				 dec cx
    396
    397	    01F3  6A 00				 push 0
    398	    01F5  51				 push cx
    399	    01F6  E8 FF98			 call point
Turbo Assembler	 Version 4.1	    21/11/22 05:43:03	    Page 8
lab1_3.asm



    400	    01F9  83 C4	04			 add sp, 4
    401
    402	    01FC  68 027F			 push 639
    403	    01FF  51				 push cx
    404	    0200  E8 FF8E			 call point
    405	    0203  83 C4	04			 add sp, 4
    406	    0206  41				 inc cx
    407	    0207  E2 E9				 loop draw_scr_loop2
    408
    409	    0209  59				 pop cx
    410	    020A  5D				 pop bp
    411	    020B  C3				 ret
    412	    020C			 draw_scr endp
    413
    414	    020C			 start:
    415	    020C  B8 0000s			 mov ax, @data
    416	    020F  8E D8				 mov ds, ax
    417	    0211  9B DB	E3			 finit
    418	    0214  E8 FF35			 call setRoundDown
    419
    420						 ; init	constatnts
    421	    0217  D9 06	0004r			 fld B
    422	    021B  D8 26	0000r			 fsub A
    423	    021F  DF 06	0F20r			 fild Wid
    424	    0223  DE F9				 fdivp
    425	    0225  D9 1E	0008r			 fstp H
    426	    0229  DD C1				 ffree
    427	    022B  D9 F6				 fdecstp
    428
    429	    022D  E8 FE03			 call fn
    430	    0230  E8 FEF7			 call setvid
    431						 ; call	draw_scr
    432						 ; call	getch
    433	    0233  E8 FF76			 call draw_fn
    434	    0236  E8 FEE5			 call getch
    435	    0239  E8 FEFF			 call settext
    436
    437						 ;exit 0
    438	    023C  B8 4C00			 mov ax,4c00h
    439	    023F  CD 21				 int 21h
    440					 end start
Turbo Assembler	 Version 4.1	    21/11/22 05:43:03	    Page 9
Symbol Table




Symbol Name		Type   Value			   Cref	(defined at #)

??DATE			Text   "21/11/22"
??FILENAME		Text   "lab1_3	"
??TIME			Text   "05:43:03"
??VERSION		Number 040A
@32BIT			Text   0			   #1
@@TMP_CWR		Number [DGROUP:BP-0002]		   #272	 274  275  277	278
@@TMP_CWR		Number [DGROUP:BP-0002]		   #291	 293  294  296	297
@@TMP_CWR		Number [DGROUP:BP-0002]		   #310	 312  313  315	316
@CODE			Text   _TEXT			   #1  #1  #25
@CODESIZE		Text   0			   #1
@CPU			Text   1F1FH			   #3
@CURSEG			Text   _TEXT			   #7  #25
@DATA			Text   DGROUP			   #1  415
@DATASIZE		Text   0			   #1
@FILENAME		Text   LAB1_3
@INTERFACE		Text   000H			   #1
@MODEL			Text   2			   #1
@STACK			Text   DGROUP			   #1
@WORDSIZE		Text   2			   #3  #7  #25
A			Dword  DGROUP:0000		   #8  422
B			Dword  DGROUP:0004		   #9  82  421
CRLF			Byte   DGROUP:0F24		   #21
CURR			Dword  DGROUP:000C		   #11	83  92	98  101
DRAW_FN			Near   _TEXT:01AC		   #346	 433
DRAW_FN_LOOP1		Near   _TEXT:01B6		   #354	 365
DRAW_SCR		Near   _TEXT:01CF		   #374
DRAW_SCR_LOOP1		Near   _TEXT:01D7		   #380	 392
DRAW_SCR_LOOP2		Near   _TEXT:01F2		   #394	 407
FN			Near   _TEXT:0033		   #73	429
FN_CALC			Near   _TEXT:0020		   #57	94
FN_LOOP1		Near   _TEXT:0045		   #85	104
FN_LOOP2		Near   _TEXT:007B		   #112	 149
FN_LOOP2_ENDMAX		Near   _TEXT:009B		   125	126  #128
FN_LOOP2_ENDMIN		Near   _TEXT:00AF		   138	#141
FN_LOOP3		Near   _TEXT:00D5		   #160	 177
GETCH			Near   _TEXT:011E		   #222	 434
GETS			Near   _TEXT:0103		   #186
H			Dword  DGROUP:0008		   #10	99  425
HEI			Word   DGROUP:0F22		   #20	153  170  393
ICWR			Word   DGROUP:0F1C		   #17
ICWR_			Word   DGROUP:0F1E		   #18
K			Dword  DGROUP:0A18		   #15	156  165
MAX			Dword  DGROUP:0A14		   #14	107  118  127  151
MIN			Dword  DGROUP:0A10		   #13	108  131  140  152  168
POINT			Near   _TEXT:0191		   #324	 362  384  389	399  404
PUTS			Near   _TEXT:010D		   #206
REPLACE			Near   _TEXT:0000		   #26
REPLACE_WHILE		Near   _TEXT:000E		   #36	45
REPLACE_WHILE_END	Near   _TEXT:001C		   38  #46
REPLACE_WHILE_SKIP	Near   _TEXT:0019		   41  #43
SETROUNDDOWN		Near   _TEXT:014C		   #267	 418
SETROUNDNEAR		Near   _TEXT:017A		   157	#305
SETROUNDUP		Near   _TEXT:0163		   #286
SETTEXT			Near   _TEXT:013B		   #251	 435
Turbo Assembler	 Version 4.1	    21/11/22 05:43:03	    Page 10
Symbol Table



SETVID			Near   _TEXT:012A		   #235	 430
START			Near   _TEXT:020C		   #414	 440
STOF			Near   _TEXT:0108		   #196
T1			Byte   DGROUP:0F27		   #22
WID			Word   DGROUP:0F20		   #19	81  111	 159  353  379	423
Y			Dword  DGROUP:0010		   #12	96  106	 117  167
YABS			Word   DGROUP:0A1C		   #16	174  359

Groups & Segments	Bit Size Align	Combine	Class	   Cref	(defined at #)

DGROUP			Group				   #1  1  415
  STACK			16  0100 Para	Stack	STACK	   #4
  _DATA			16  0F36 Word	Public	DATA	   #1  #7
_TEXT			16  0241 Word	Public	CODE	   #1  1  #25  25
